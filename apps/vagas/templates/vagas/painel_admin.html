<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vagalume Carreiras - Painel ADM</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #0a0a0a; color: #fff; min-height: 100vh;
        }
        body::before {
            content: ''; position: fixed; right: -200px; top: 0; width: 800px; height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 1200"><path d="M400,100 Q600,300 400,500 T400,900" fill="none" stroke="rgba(168,255,53,0.05)" stroke-width="100"/></svg>');
            pointer-events: none; z-index: 0;
        }
        .container { position: relative; z-index: 1; }

        /* Hero */
        .hero { text-align: center; padding: 60px 20px 40px; }
        .hero h1 { font-size: 36px; margin-bottom: 10px; }
        .hero h1 .username { color: #a8ff35; }
        .hero p { color: #94a3b8; }

        /* Stats */
        .stats-container { display: flex; justify-content: center; gap: 15px; margin: 30px 0; flex-wrap: wrap; }
        .stat-btn { padding: 10px 20px; background: transparent; border: 1px solid #2d3f52; color: #fff; border-radius: 6px; font-size: 13px; }
        .stat-btn:hover { border-color: #a8ff35; color: #a8ff35; }

        /* Main Content */
        .main-content { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        /* BUSCA */
        .search-container { margin-bottom: 40px; max-width: 600px; margin-left: auto; margin-right: auto; }
        .search-box { display: flex; background: rgba(30, 41, 59, 0.5); border: 1px solid #2d3f52; border-radius: 50px; padding: 5px 20px; align-items: center; }
        .search-box input { flex: 1; background: transparent; border: none; color: #fff; padding: 10px; outline: none; font-size: 1rem; }
        .search-box button { background: none; border: none; color: #a8ff35; cursor: pointer; font-weight: bold; }

        /* LISTAS */
        .lists-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 30px; }
        .list-section { background: rgba(20, 20, 20, 0.6); border: 1px solid #1e293b; border-radius: 12px; overflow: hidden; }
        .list-header { background: rgba(168, 255, 53, 0.05); padding: 15px 20px; border-bottom: 1px solid #1e293b; font-weight: bold; color: #a8ff35; }
        
        .list-item { display: flex; align-items: center; justify-content: space-between; padding: 15px 20px; border-bottom: 1px solid #1e293b; }
        .list-item:last-child { border-bottom: none; }
        .item-info { display: flex; flex-direction: column; }
        .item-name { font-weight: 600; color: #fff; }
        .item-sub { font-size: 0.85rem; color: #94a3b8; }
        
        /* BOTÕES DE AÇÃO */
        .item-actions { display: flex; gap: 8px; }
        .btn-view { padding: 5px 12px; background: #2d3f52; color: #fff; border-radius: 4px; text-decoration: none; font-size: 0.8rem; }
        .btn-toggle { padding: 5px 12px; border-radius: 4px; border: none; cursor: pointer; font-size: 0.8rem; font-weight: bold; }
        
        .status-active { background: rgba(220, 38, 38, 0.2); color: #f87171; border: 1px solid #f87171; } /* Vermelho para desativar */
        .status-active:hover { background: rgba(220, 38, 38, 0.4); }
        
        .status-inactive { background: rgba(22, 163, 74, 0.2); color: #4ade80; border: 1px solid #4ade80; } /* Verde para ativar */
        .status-inactive:hover { background: rgba(22, 163, 74, 0.4); }

        /* Mensagens */
        .messages { text-align: center; margin-bottom: 20px; }
        .msg { display: inline-block; padding: 10px 20px; border-radius: 20px; background: #a8ff35; color: #000; font-weight: bold; }
        
        .back-link { display: block; text-align: center; margin-top: 40px; color: #64748b; text-decoration: none; }
        .back-link:hover { color: #fff; }
    </style>
</head>
<body>
    <div class="container">
        <section class="hero">
            <h1>Painel Admin <span class="username">{{ nome_admin }}</span></h1>
            <p>Gerencie usuários e empresas.</p>
        </section>

        <div class="main-content">
            
            {% if messages %}
                <div class="messages">
                    {% for message in messages %}
                        <div class="msg">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}

            <div class="search-container">
                <form method="GET" action="{% url 'painel_admin' %}">
                    <div class="search-box">
                        <input type="text" name="q" placeholder="Buscar por nome, email ou CNPJ..." value="{{ busca_atual }}">
                        <button type="submit">BUSCAR</button>
                    </div>
                </form>
            </div>

            <div class="stats-container">
                <div class="stat-btn">+{{ stat_novos_candidatos }} Candidatos (30d)</div>
                <div class="stat-btn">+{{ stat_novas_empresas }} Empresas (30d)</div>
                <div class="stat-btn">{{ stat_vagas_ativas }} Vagas Ativas</div>
            </div>

            <div class="lists-container">
                
                <div class="list-section">
                    <div class="list-header">Últimos Candidatos</div>
                    {% for candidato in lista_candidatos %}
                    <div class="list-item">
                        <div class="item-info">
                            <span class="item-name">{{ candidato.usuario.first_name }} {{ candidato.usuario.last_name }}</span>
                            <span class="item-sub">{{ candidato.usuario.email }}</span>
                            {% if not candidato.usuario.is_active %}<span style="color:#f87171; font-size:0.7rem;">(DESATIVADO)</span>{% endif %}
                        </div>
                        <div class="item-actions">
                            <a href="{% url 'perfil_publico' candidato.usuario.username %}" target="_blank" class="btn-view">Ver</a>
                            
                            <form action="{% url 'toggle_status_usuario' candidato.usuario.id %}" method="POST" style="display:inline;">
                                {% csrf_token %}
                                {% if candidato.usuario.is_active %}
                                    <button type="submit" class="btn-toggle status-active" onclick="return confirm('Tem certeza que deseja DESATIVAR este usuário?')">Desativar</button>
                                {% else %}
                                    <button type="submit" class="btn-toggle status-inactive">Ativar</button>
                                {% endif %}
                            </form>
                        </div>
                    </div>
                    {% empty %}
                    <div class="list-item" style="color: #64748b; justify-content: center;">Nenhum candidato encontrado.</div>
                    {% endfor %}
                </div>

                <div class="list-section">
                    <div class="list-header">Últimas Empresas</div>
                    {% for empresa in lista_empresas %}
                    <div class="list-item">
                        <div class="item-info">
                            <span class="item-name">{{ empresa.nome }}</span>
                            <span class="item-sub">CNPJ: {{ empresa.cnpj }}</span>
                        </div>
                        <div class="item-actions">
                            <a href="{% url 'ver_empresa' empresa.id %}" target="_blank" class="btn-view">Ver</a>
                            
                            {% with empresa.recrutador_set.first as recrutador %}
                                {% if recrutador %}
                                    <form action="{% url 'toggle_status_usuario' recrutador.usuario.id %}" method="POST" style="display:inline;">
                                        {% csrf_token %}
                                        {% if recrutador.usuario.is_active %}
                                            <button type="submit" class="btn-toggle status-active" onclick="return confirm('Isso impedirá o login da empresa. Confirmar?')">Bloquear</button>
                                        {% else %}
                                            <button type="submit" class="btn-toggle status-inactive">Desbloq.</button>
                                        {% endif %}
                                    </form>
                                {% endif %}
                            {% endwith %}
                        </div>
                    </div>
                    {% empty %}
                    <div class="list-item" style="color: #64748b; justify-content: center;">Nenhuma empresa encontrada.</div>
                    {% endfor %}
                </div>

            </div>
            
            <a href="{% url 'landing_page' %}" class="back-link">← Voltar para o Site</a>
        </div>
    </div>
</body>
</html>