{% extends 'base.html' %}
{% load static %}
{% block title %}Radar de Talentos{% endblock %}

{% block content %}
<style>
    .radar-container {
        max-width: 900px;
        margin: 20px auto;
        padding: 20px;
    }
    .radar-header {
        text-align: center;
        padding: 20px;
        background-color: #161B22;
        border: 1px solid #30363d;
        border-radius: 8px;
        margin-bottom: 30px;
    }
    .radar-header h1 {
        color: #fff;
        font-size: 2rem;
        margin: 0 0 10px 0;
    }
    .radar-header p {
        color: #8b949e;
        font-size: 1.1rem;
        margin: 0;
    }
    
    /* --- CSS PARA O NOVO FORMULÁRIO --- */
    .radar-form {
        background-color: #161B22;
        border: 1px solid #30363d;
        border-radius: 8px;
        margin-bottom: 30px;
        padding: 25px;
        display: flex;
        align-items: center;
        gap: 20px;
    }
    .radar-form label {
        color: #c9d1d9;
        font-size: 1.1rem;
        font-weight: bold;
        flex-shrink: 0; /* Não encolhe o label */
    }
    .radar-form select {
        flex-grow: 1; /* Ocupa o espaço */
        background-color: #0d1117; 
        border: 1px solid #30363d; 
        color: #c9d1d9; 
        padding: 12px 15px;
        border-radius: 5px;
        font-size: 1rem;
        font-family: 'Plus Jakarta Sans', sans-serif;
    }
    .btn-buscar-radar {
        background-color: #AFEB83; 
        color: #0D1117; 
        padding: 12px 20px;
        text-decoration: none;
        border-radius: 5px;
        font-weight: bold;
        border: none;
        cursor: pointer;
        font-size: 1rem;
    }
    /* --- FIM DO CSS DO FORM --- */
    
    .radar-count {
        color: #BEF264; /* Verde */
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 20px;
    }
    
    /* (O CSS do .candidato-card fica igual) */
    .candidato-card {
        background: #161B22;
        border: 1px solid #30363d;
        padding: 25px;
        margin-bottom: 15px;
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .candidato-info { display: flex; align-items: center; }
    .candidato-foto { width: 60px; height: 60px; border-radius: 50%; background-color: #30363d; margin-right: 20px; }
    .candidato-detalhes h3 { color: #fff; margin: 0 0 5px 0; font-size: 1.25rem; }
    .candidato-detalhes p { color: #8b949e; margin: 0; font-size: 0.95rem; }
    .candidato-botoes a { display: block; text-decoration: none; padding: 8px 15px; border-radius: 5px; font-weight: bold; font-size: 0.9rem; text-align: center; }
    .btn-ver-perfil { background-color: #AFEB83; color: #0D1117; margin-bottom: 8px; }
    .btn-contato { background-color: transparent; border: 1px solid #30363d; color: #c9d1d9; }
</style>

<div class="radar-container">
    
    <div class="radar-header">
        <h1>Radar de Talentos Proativo</h1>
        <p>Encontre candidatos em todo o banco de dados que se encaixam perfeitamente em uma de suas vagas.</p>
    </div>

    <form class="radar-form" method="POST">
        {% csrf_token %}
        <label for="id_vaga">Buscar talentos para a vaga:</label>
        <select name="vaga_id" id="id_vaga">
            <option value="">-- Selecione uma vaga --</option>
            {% for vaga in minhas_vagas %}
                <option value="{{ vaga.id }}" {% if vaga.id == vaga_selecionada_id %}selected{% endif %}>
                    {{ vaga.titulo }}
                </option>
            {% endfor %}
        </select>
        <button type="submit" class="btn-buscar-radar">Buscar</button>
    </form>


    {% if request.method == 'POST' %}
        <h2 class="radar-count">{{ total_encontrados }} candidatos encontrados</h2>

        {% for item in candidatos_ordenados %}
        <div class="candidato-card">
            
            <div class="candidato-info">
                <div class="candidato-foto">
                    </div>
                <div class.="candidato-detalhes">
                    <h3>{{ item.candidato.usuario.get_full_name }} ({{item.score}}%)</h3>
                    <p>{{ item.candidato.headline|default:"Sem cargo" }}</p>
                </div>
            </div>

<div class="candidato-botoes">
    <a href="{% url 'perfil_publico' item.candidato.usuario.username %}" class="btn-ver-perfil">
        Ver Perfil
    </a>
    
    <a href="mailto:{{ item.candidato.usuario.email }}" class="btn-contato">
        Entrar em contato
    </a>
</div>

        </div>
        {% empty %}
            <p style="text-align: center; color: #8b949e; padding: 20px;">
                Nenhum candidato com mais de 20% de compatibilidade foi encontrado no banco de dados.
            </p>
        {% endfor %}
    {% endif %}

</div>
{% endblock %}